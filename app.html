<!DOCTYPE html>
<!-- BYU-themed Minesweeper game created with AI help -->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BYU Minesweeper | Web App</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #002E5D 0%, #0057B8 100%);
            color: #fff;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            padding: 20px;
        }
        .game-container {
            background: #fff;
            border-radius: 16px;
            padding: 20px;
            box-shadow: 0 12px 30px rgba(0,0,0,0.4);
            text-align: center;
        }
        h1 {
            color: #002E5D;
            margin-bottom: 12px;
            font-size: 28px;
        }
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #002E5D;
            padding: 12px 16px;
            border-radius: 8px;
            margin-bottom: 16px;
            color: #fff;
        }
        .header-item {
            font-weight: 700;
            font-size: 18px;
        }
        #cosmo-face {
            font-size: 20px;
            font-weight: 700;
            cursor: pointer;
            user-select: none;
            color: #fff;
        }
        #board {
            display: inline-grid;
            grid-template-columns: repeat(9, 32px);
            grid-template-rows: repeat(9, 32px);
            gap: 2px;
            background: #999;
            padding: 4px;
            border-radius: 8px;
            position: relative;
        }
        .cell {
            width: 32px;
            height: 32px;
            background: #bbb;
            border: 2px outset #ddd;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 14px;
            cursor: pointer;
            user-select: none;
        }
        .cell:hover {
            background: #ccc;
        }
        .cell.revealed {
            background: #e0e0e0;
            border: 1px solid #999;
            cursor: default;
        }
        .cell.revealed:hover {
            background: #e0e0e0;
        }
        .cell.flagged {
            background: #ffeb3b;
        }
        .cell.question {
            background: #ff9800;
        }
        .utah-bomb {
            font-size: 18px;
            font-weight: 900;
            color: #CC0000;
            font-family: 'Arial Black', 'Arial Bold', sans-serif;
            text-shadow: 1px 1px 0px #8B0000;
        }
        .mine-count-1 { color: #0057B8; }
        .mine-count-2 { color: #388e3c; }
        .mine-count-3 { color: #d32f2f; }
        .mine-count-4 { color: #7b1fa2; }
        .mine-count-5 { color: #f57c00; }
        .mine-count-6 { color: #00796b; }
        .mine-count-7 { color: #303f9f; }
        .mine-count-8 { color: #424242; }
        .footer {
            margin-top: 16px;
            color: #002E5D;
        }
        .footer a {
            color: #0057B8;
            text-decoration: none;
            font-weight: 600;
        }
        .footer a:hover {
            text-decoration: underline;
        }
        #confetti-canvas {
            position: absolute;
            top: 0;
            left: 0;
            pointer-events: none;
            z-index: 999;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <h1>üèà BYU Minesweeper üèà</h1>
        <div class="header">
            <div class="header-item">üí£ <span id="mine-count">10</span></div>
            <div id="cosmo-face" title="Click to restart">üò∫</div>
            <div class="header-item">‚è±Ô∏è <span id="timer">0</span></div>
        </div>
        <div id="board"></div>
        <canvas id="confetti-canvas"></canvas>
        <div class="footer">
            <p><strong>Left-click</strong> to reveal | <strong>Right-click</strong> to flag üè¥ | <strong>Double right-click</strong> for ‚ùì</p>
            <p><strong>Both buttons</strong> on revealed number to chord (auto-reveal neighbors if flags match)</p>
            <p style="margin-top: 8px;"><a href="scratch.html">‚Üê Back to scratch page</a></p>
        </div>
    </div>

    <script>
        const ROWS = 9, COLS = 9, MINES = 10;
        let board = [], revealed = [], flagged = [], questioned = [];
        let gameOver = false, gameWon = false, firstClick = true;
        let minesLeft = MINES, timer = 0, timerInterval = null;

        const boardEl = document.getElementById('board');
        const cosmoEl = document.getElementById('cosmo-face');
        const mineCountEl = document.getElementById('mine-count');
        const timerEl = document.getElementById('timer');
        const canvas = document.getElementById('confetti-canvas');
        const ctx = canvas.getContext('2d');

        function init() {
            board = Array(ROWS).fill(null).map(() => Array(COLS).fill(0));
            revealed = Array(ROWS).fill(null).map(() => Array(COLS).fill(false));
            flagged = Array(ROWS).fill(null).map(() => Array(COLS).fill(false));
            questioned = Array(ROWS).fill(null).map(() => Array(COLS).fill(false));
            gameOver = false;
            gameWon = false;
            firstClick = true;
            minesLeft = MINES;
            timer = 0;
            mineCountEl.textContent = minesLeft;
            timerEl.textContent = timer;
            cosmoEl.textContent = 'ÔøΩ Happy';
            clearInterval(timerInterval);
            renderBoard();
        }

        function placeMines(avoidRow, avoidCol) {
            let placed = 0;
            while (placed < MINES) {
                const r = Math.floor(Math.random() * ROWS);
                const c = Math.floor(Math.random() * COLS);
                if (board[r][c] !== -1 && !(r === avoidRow && c === avoidCol)) {
                    board[r][c] = -1;
                    placed++;
                }
            }
            for (let r = 0; r < ROWS; r++) {
                for (let c = 0; c < COLS; c++) {
                    if (board[r][c] !== -1) {
                        let count = 0;
                        for (let dr = -1; dr <= 1; dr++) {
                            for (let dc = -1; dc <= 1; dc++) {
                                const nr = r + dr, nc = c + dc;
                                if (nr >= 0 && nr < ROWS && nc >= 0 && nc < COLS && board[nr][nc] === -1) count++;
                            }
                        }
                        board[r][c] = count;
                    }
                }
            }
        }

        function renderBoard() {
            boardEl.innerHTML = '';
            for (let r = 0; r < ROWS; r++) {
                for (let c = 0; c < COLS; c++) {
                    const cell = document.createElement('div');
                    cell.className = 'cell';
                    cell.dataset.row = r;
                    cell.dataset.col = c;
                    
                    if (revealed[r][c]) {
                        cell.classList.add('revealed');
                        if (board[r][c] === -1) {
                            cell.innerHTML = '<span class="utah-bomb">U</span>';
                        } else if (board[r][c] > 0) {
                            cell.textContent = board[r][c];
                            cell.classList.add(`mine-count-${board[r][c]}`);
                        }
                    } else if (flagged[r][c]) {
                        cell.classList.add('flagged');
                        cell.textContent = 'üè¥'; // Cosmo flag placeholder
                    } else if (questioned[r][c]) {
                        cell.classList.add('question');
                        cell.textContent = '‚ùì';
                    }

                    cell.addEventListener('click', (e) => handleLeftClick(r, c, e));
                    cell.addEventListener('contextmenu', (e) => {
                        e.preventDefault();
                        handleRightClick(r, c);
                    });
                    cell.addEventListener('mousedown', (e) => handleMouseDown(r, c, e));
                    
                    boardEl.appendChild(cell);
                }
            }
        }

        let leftPressed = false, rightPressed = false;

        function handleMouseDown(r, c, e) {
            if (e.button === 0) leftPressed = true;
            if (e.button === 2) rightPressed = true;
            
            if (leftPressed && rightPressed) {
                e.preventDefault();
                handleChord(r, c);
            }
        }

        document.addEventListener('mouseup', (e) => {
            if (e.button === 0) leftPressed = false;
            if (e.button === 2) rightPressed = false;
        });

        function handleChord(r, c) {
            if (gameOver || gameWon || !revealed[r][c] || board[r][c] <= 0) return;

            let flagCount = 0;
            const neighbors = [];
            for (let dr = -1; dr <= 1; dr++) {
                for (let dc = -1; dc <= 1; dc++) {
                    if (dr === 0 && dc === 0) continue;
                    const nr = r + dr, nc = c + dc;
                    if (nr >= 0 && nr < ROWS && nc >= 0 && nc < COLS) {
                        neighbors.push([nr, nc]);
                        if (flagged[nr][nc]) flagCount++;
                    }
                }
            }

            if (flagCount === board[r][c]) {
                for (const [nr, nc] of neighbors) {
                    if (!revealed[nr][nc] && !flagged[nr][nc]) {
                        if (board[nr][nc] === -1) {
                            revealAll();
                            gameOver = true;
                            cosmoEl.textContent = 'üêÜ Sad';
                            clearInterval(timerInterval);
                            setTimeout(() => alert('üí• You hit a Utah bomb! Game Over!'), 100);
                            renderBoard();
                            return;
                        }
                        reveal(nr, nc);
                    }
                }
                checkWin();
                renderBoard();
            }
        }

        function handleLeftClick(r, c, e) {
            if (gameOver || gameWon || revealed[r][c] || flagged[r][c]) return;

            if (firstClick) {
                placeMines(r, c);
                firstClick = false;
                timerInterval = setInterval(() => {
                    timer++;
                    timerEl.textContent = timer;
                }, 1000);
            }

            if (board[r][c] === -1) {
                revealAll();
                gameOver = true;
                cosmoEl.textContent = 'üêÜ Sad';
                clearInterval(timerInterval);
                setTimeout(() => alert('üí• You hit a Utah bomb! Game Over!'), 100);
            } else {
                reveal(r, c);
                checkWin();
            }
            renderBoard();
        }

        function handleRightClick(r, c) {
            if (gameOver || gameWon || revealed[r][c]) return;

            if (!flagged[r][c] && !questioned[r][c]) {
                flagged[r][c] = true;
                minesLeft--;
            } else if (flagged[r][c]) {
                flagged[r][c] = false;
                questioned[r][c] = true;
                minesLeft++;
            } else if (questioned[r][c]) {
                questioned[r][c] = false;
            }

            mineCountEl.textContent = minesLeft;
            renderBoard();
        }

        function reveal(r, c) {
            if (r < 0 || r >= ROWS || c < 0 || c >= COLS || revealed[r][c]) return;
            revealed[r][c] = true;
            if (board[r][c] === 0) {
                for (let dr = -1; dr <= 1; dr++) {
                    for (let dc = -1; dc <= 1; dc++) {
                        reveal(r + dr, c + dc);
                    }
                }
            }
        }

        function revealAll() {
            for (let r = 0; r < ROWS; r++) {
                for (let c = 0; c < COLS; c++) {
                    revealed[r][c] = true;
                }
            }
        }

        function checkWin() {
            let allRevealed = true;
            for (let r = 0; r < ROWS; r++) {
                for (let c = 0; c < COLS; c++) {
                    if (board[r][c] !== -1 && !revealed[r][c]) {
                        allRevealed = false;
                    }
                }
            }
            if (allRevealed) {
                gameWon = true;
                gameOver = true;
                cosmoEl.textContent = 'ÔøΩüí• WIN!';
                clearInterval(timerInterval);
                launchConfetti();
                setTimeout(() => alert('üéâ You won! Go Cougars!'), 100);
            }
        }

        function launchConfetti() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            const confetti = [];
            for (let i = 0; i < 150; i++) {
                confetti.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height - canvas.height,
                    r: Math.random() * 4 + 2,
                    d: Math.random() * 10 + 5,
                    color: `hsl(${Math.random() * 360}, 70%, 60%)`,
                    tilt: Math.random() * 10 - 5
                });
            }
            function draw() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                confetti.forEach((p, i) => {
                    ctx.beginPath();
                    ctx.arc(p.x, p.y, p.r, 0, 2 * Math.PI);
                    ctx.fillStyle = p.color;
                    ctx.fill();
                    p.y += p.d;
                    p.x += p.tilt;
                    if (p.y > canvas.height) confetti.splice(i, 1);
                });
                if (confetti.length > 0) requestAnimationFrame(draw);
            }
            draw();
        }

        cosmoEl.addEventListener('click', init);
        init();
    </script>
</body>
</html>
